<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>メモリ内でデータを保存し複数グラフを描画</title>
    <style>
        .container {
            max-width: 86vw;
            max-height: 86vh;
            margin: 0 auto;
            text-align: center;
        }

        canvas {
            display: block;
            margin: 20px auto;
            width: 100%;
            height: auto;
        }

        .graph-controls {
            margin-bottom: 20px;
        }

        #resetButton1,
        #resetButton2,
        #resetButton3,
        #inputValue1,
        #inputValue2,
        #inputValue3,
        #submitButton1,
        #submitButton2,
        #submitButton3,
        #titleInput1,
        #titleInput2,
        #titleInput3,
        #updateTitleButton1,
        #updateTitleButton2,
        #updateTitleButton3 {
            margin: 10px;
            padding: 10px;
            font-size: 16px;
        }

        button {
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
        }

        button:hover {
            background-color: #45a049;
        }

        .resetButton {
            background-color: #f44336;
        }

        .resetButton:hover {
            background-color: #d32f2f;
        }
    </style>
</head>

<body>
    <div class="container">
        <!-- 体重グラフ -->
        <div class="graph-controls">
            <input type="number" id="inputValue1" placeholder="値を入力 (A)" step="0.1">
            <button type="button" id="submitButton1">グラフAを更新</button>
            <button type="button" id="resetButton1" class="resetButton">グラフAのデータ削除</button>
            <input type="text" id="titleInput1" placeholder="タイトルを入力 (A)">
            <button type="button" id="updateTitleButton1">タイトルを更新</button>
        </div>
        <canvas id="chartA"></canvas>

        <!-- 株価グラフ -->
        <div class="graph-controls">
            <input type="number" id="inputValue2" placeholder="値を入力 (B)" step="0.01">
            <button type="button" id="submitButton2">グラフBを更新</button>
            <button type="button" id="resetButton2" class="resetButton">グラフBのデータ削除</button>
            <input type="text" id="titleInput2" placeholder="タイトルを入力 (B)">
            <button type="button" id="updateTitleButton2">タイトルを更新</button>
        </div>
        <canvas id="chartB"></canvas>

        <!-- 順位グラフ -->
        <div class="graph-controls">
            <input type="number" id="inputValue3" placeholder="値を入力 (C)" step="1">
            <button type="button" id="submitButton3">グラフCを更新</button>
            <button type="button" id="resetButton3" class="resetButton">グラフCのデータ削除</button>
            <input type="text" id="titleInput3" placeholder="タイトルを入力 (C)">
            <button type="button" id="updateTitleButton3">タイトルを更新</button>
        </div>
        <canvas id="chartC"></canvas>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
    <script src="https://cdn.jsdelivr.net/npm/date-fns"></script>
    <script>
        // ローカルストレージからデータを取得
        function loadFromLocalStorage() {
            const dataA = JSON.parse(localStorage.getItem('dataA') || '[]');
            const dataB = JSON.parse(localStorage.getItem('dataB') || '[]');
            const dataC = JSON.parse(localStorage.getItem('dataC') || '[]');
            const titleA = localStorage.getItem('titleA') || 'グラフA';
            const titleB = localStorage.getItem('titleB') || 'グラフB';
            const titleC = localStorage.getItem('titleC') || 'グラフC';
            return { dataA, dataB, dataC, titleA, titleB, titleC };
        }

        // ローカルストレージにデータを保存
        function saveToLocalStorage() {
            localStorage.setItem('dataA', JSON.stringify(memoryStorage.dataA));
            localStorage.setItem('dataB', JSON.stringify(memoryStorage.dataB));
            localStorage.setItem('dataC', JSON.stringify(memoryStorage.dataC));
            localStorage.setItem('titleA', memoryStorage.titleA);
            localStorage.setItem('titleB', memoryStorage.titleB);
            localStorage.setItem('titleC', memoryStorage.titleC);
        }

        // メモリ内にデータを保存するためのオブジェクト
        const memoryStorage = loadFromLocalStorage();

        // データを保存する関数
        function saveData(key, value) {
            const timestamp = new Date().toISOString();
            memoryStorage[key].push({ time: timestamp, value: value });
            saveToLocalStorage();  // データが変更されたらローカルストレージに保存
        }

        // データを取得してグラフを描画する関数
        function updateChart(chart, key) {
            const data = memoryStorage[key].map(item => ({ x: new Date(item.time), y: parseFloat(item.value) }));
            chart.data.datasets[0].data = data;
            chart.update();
        }

        // グラフ初期化関数
        function createChart(ctx, title) {
            return new Chart(ctx, {
                type: 'line',
                data: {
                    datasets: [{
                        label: '値',
                        data: [],
                        borderColor: 'rgba(75, 192, 192, 1)',
                        borderWidth: 2,
                        fill: false
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: title
                        }
                    },
                    scales: {
                        x: {
                            type: 'time',
                            time: {
                                unit: 'minute',
                                tooltipFormat: 'yyyy-MM-dd HH:mm:ss',
                                displayFormats: {
                                    minute: 'yyyy-MM-dd HH:mm'
                                }
                            },
                            title: {
                                display: true,
                                text: '日時'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: '値'
                            },
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        // ページが読み込まれたときにグラフを初期化
        document.addEventListener('DOMContentLoaded', function () {
            const ctxA = document.getElementById('chartA').getContext('2d');
            const chartA = createChart(ctxA, memoryStorage.titleA);
            const ctxB = document.getElementById('chartB').getContext('2d');
            const chartB = createChart(ctxB, memoryStorage.titleB);
            const ctxC = document.getElementById('chartC').getContext('2d');
            const chartC = createChart(ctxC, memoryStorage.titleC);

            updateChart(chartA, 'dataA');
            updateChart(chartB, 'dataB');
            updateChart(chartC, 'dataC');

            document.getElementById('submitButton1').addEventListener('click', function () {
                const inputValue1 = document.getElementById('inputValue1').value;
                if (inputValue1 !== "") {
                    saveData('dataA', parseFloat(inputValue1));
                    updateChart(chartA, 'dataA');
                    document.getElementById('inputValue1').value = '';
                }
            });

            document.getElementById('submitButton2').addEventListener('click', function () {
                const inputValue2 = document.getElementById('inputValue2').value;
                if (inputValue2 !== "") {
                    saveData('dataB', parseFloat(inputValue2));
                    updateChart(chartB, 'dataB');
                    document.getElementById('inputValue2').value = '';
                }
            });

            document.getElementById('submitButton3').addEventListener('click', function () {
                const inputValue3 = document.getElementById('inputValue3').value;
                if (inputValue3 !== "") {
                    saveData('dataC', parseFloat(inputValue3));
                    updateChart(chartC, 'dataC');
                    document.getElementById('inputValue3').value = '';
                }
            });

            document.getElementById('resetButton1').addEventListener('click', function () {
                memoryStorage.dataA = [];
                saveToLocalStorage();
                updateChart(chartA, 'dataA');
            });

            document.getElementById('resetButton2').addEventListener('click', function () {
                memoryStorage.dataB = [];
                saveToLocalStorage();
                updateChart(chartB, 'dataB');
            });

            document.getElementById('resetButton3').addEventListener('click', function () {
                memoryStorage.dataC = [];
                saveToLocalStorage();
                updateChart(chartC, 'dataC');
            });

            document.getElementById('updateTitleButton1').addEventListener('click', function () {
                const titleInput1 = document.getElementById('titleInput1').value;
                if (titleInput1 !== "") {
                    memoryStorage.titleA = titleInput1;
                    chartA.options.plugins.title.text = memoryStorage.titleA;
                    chartA.update();
                    saveToLocalStorage();
                }
            });

            document.getElementById('updateTitleButton2').addEventListener('click', function () {
                const titleInput2 = document.getElementById('titleInput2').value;
                if (titleInput2 !== "") {
                    memoryStorage.titleB = titleInput2;
                    chartB.options.plugins.title.text = memoryStorage.titleB;
                    chartB.update();
                    saveToLocalStorage();
                }
            });

            document.getElementById('updateTitleButton3').addEventListener('click', function () {
                const titleInput3 = document.getElementById('titleInput3').value;
                if (titleInput3 !== "") {
                    memoryStorage.titleC = titleInput3;
                    chartC.options.plugins.title.text = memoryStorage.titleC;
                    chartC.update();
                    saveToLocalStorage();
                }
            });
        });
    </script>
</body>

</html>

