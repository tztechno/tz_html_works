<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>グラフのデータを記憶</title>
    <style>
        .container {
            max-width: 86vw;
            max-height: 86vh;
            margin: 0 auto;
            text-align: center;
        }

        canvas {
            display: block;
            margin: 20px auto;
            width: 100%;
            height: auto;
        }

        .graph-controls {
            margin-bottom: 20px;
        }

        #inputValue,
        #submitButton,
        #resetButton {
            margin: 10px;
            padding: 10px;
            font-size: 16px;
        }

        button {
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
        }

        button:hover {
            background-color: #45a049;
        }

        .resetButton {
            background-color: #f44336;
        }

        .resetButton:hover {
            background-color: #d32f2f;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="graph-controls">
            <input type="number" id="inputValue" placeholder="値を入力" step="0.1">
            <button type="button" id="submitButton">グラフを更新</button>
            <button type="button" id="resetButton" class="resetButton">グラフのデータ削除</button>
        </div>
        <canvas id="chart"></canvas>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // グラフデータをlocalStorageから取得する関数
        function loadDataFromLocalStorage() {
            const storedData = localStorage.getItem('graphData');
            return storedData ? JSON.parse(storedData) : [];
        }

        // グラフデータをlocalStorageに保存する関数
        function saveDataToLocalStorage(data) {
            localStorage.setItem('graphData', JSON.stringify(data));
        }

        // データを保存する関数
        function saveData(value) {
            const timestamp = new Date().toISOString(); // ISO形式の日時を取得
            const data = loadDataFromLocalStorage();
            data.push({ time: timestamp, value: value });
            saveDataToLocalStorage(data);
        }

        // データを取得してグラフを描画する関数
        function updateChart(chart) {
            const data = loadDataFromLocalStorage().map(item => ({ x: new Date(item.time), y: parseFloat(item.value) }));
            chart.data.datasets[0].data = data;
            chart.update();
        }

        // グラフ初期化関数
        function createChart(ctx) {
            return new Chart(ctx, {
                type: 'line',
                data: {
                    datasets: [{
                        label: '値',
                        data: [],
                        borderColor: 'rgba(75, 192, 192, 1)',
                        borderWidth: 2,
                        fill: false
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: 'データ記憶グラフ'
                        }
                    },
                    scales: {
                        x: {
                            type: 'time',
                            time: {
                                unit: 'minute',
                                tooltipFormat: 'yyyy-MM-dd HH:mm:ss',
                                displayFormats: {
                                    minute: 'yyyy-MM-dd HH:mm'  // 日付と時刻を表示
                                }
                            },
                            title: {
                                display: true,
                                text: '日時'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: '値'
                            },
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        document.addEventListener('DOMContentLoaded', function () {
            // グラフの初期化
            const ctx = document.getElementById('chart').getContext('2d');
            const chart = createChart(ctx);

            // ページが読み込まれた際にグラフを更新
            updateChart(chart);

            // グラフ更新ボタンの処理
            document.getElementById('submitButton').addEventListener('click', function () {
                const inputValue = document.getElementById('inputValue').value;
                if (inputValue !== "") {
                    saveData(parseFloat(inputValue));
                    updateChart(chart);
                    document.getElementById('inputValue').value = '';
                }
            });

            // グラフリセットボタンの処理
            document.getElementById('resetButton').addEventListener('click', function () {
                localStorage.removeItem('graphData'); // localStorageからデータ削除
                updateChart(chart);
            });
        });
    </script>
</body>

</html>

